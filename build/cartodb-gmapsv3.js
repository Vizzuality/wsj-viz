if("undefined"===typeof google.maps.CartoDBLayer)google.maps.CartoDBLayer=function(a){function d(b){b.map_key||$.ajax({method:"get",url:"http://"+b.user_name+".cartodb.com/api/v1/sql/?q="+escape("select ST_Extent(the_geom) from "+b.table_name)+"&callback=?",dataType:"jsonp",success:function(c){if(null!=c.rows[0].st_extent){var a=c.rows[0].st_extent.replace("BOX(","").replace(")","").split(","),c=a[0].split(" "),a=a[1].split(" "),e=new google.maps.LatLngBounds;if(180<c[0]||-180>c[0]||90<c[1]||-90>
c[1]||180<a[0]||-180>a[0]||90<a[1]||-90>a[1])c[0]="-30",c[1]="-50",a[0]="110",a[1]="80";e.extend(new google.maps.LatLng(c[1],c[0]));e.extend(new google.maps.LatLng(a[1],a[0]));b.map.fitBounds(e)}},error:function(){}})}function f(b){$.ajax({url:"http://"+b.user_name+".cartodb.com/tiles/"+b.table_name+"/map_metadata?map_key="+(b.map_key||"")+"&callback=?",dataType:"jsonp",success:function(c){c=$.parseJSON(c.map_metadata);!c||"roadmap"==c.google_maps_base_type?b.map.setOptions({mapTypeId:google.maps.MapTypeId.ROADMAP}):
"satellite"==c.google_maps_base_type?b.map.setOptions({mapTypeId:google.maps.MapTypeId.SATELLITE}):"terrain"==c.google_maps_base_type?b.map.setOptions({mapTypeId:google.maps.MapTypeId.TERRAIN}):(c.google_maps_customization_style=[{stylers:[{saturation:-65},{gamma:1.52}]},{featureType:"administrative",stylers:[{saturation:-95},{gamma:2.26}]},{featureType:"water",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"administrative.locality",stylers:[{visibility:"off"}]},{featureType:"road",
stylers:[{visibility:"simplified"},{saturation:-99},{gamma:2.22}]},{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.arterial",stylers:[{visibility:"off"}]},{featureType:"road.local",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"transit",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi",stylers:[{saturation:-55}]}],b.map.setOptions({mapTypeId:google.maps.MapTypeId.ROADMAP}));
c||(c={google_maps_customization_style:[]});b.map.setOptions({styles:c.google_maps_customization_style})},error:function(){}})}function g(b){var c={getTileUrl:function(c,a){return"http://"+b.user_name+".cartodb.com/tiles/"+b.table_name+"/"+a+"/"+c.x+"/"+c.y+".png?sql="+b.query+"&map_key="+(b.map_key||"")},tileSize:new google.maps.Size(256,256),name:b.query,description:!1};b.layer=new google.maps.ImageMapType(c);b.map.overlayMapTypes.insertAt(0,b.layer)}function e(b){b.tilejson=j(b);b.infowindow=new CartoDBInfowindow(b);
b.cache_buster=0;b.waxOptions={callbacks:{out:function(){b.map.setOptions({draggableCursor:"default"})},over:function(){b.map.setOptions({draggableCursor:"pointer"})},click:function(c,a,e,d){b.infowindow.hideAll();b.infowindow.open(c,d.latLng)}},clickAction:"full"};b.layer=new wax.g.connector(b.tilejson);b.map.overlayMapTypes.insertAt(0,b.layer);b.interaction=wax.g.interaction(b.map,b.tilejson,b.waxOptions)}function h(b,c){if(!b.infowindow){i(b.map,b.layer);b.query=c;var a={getTileUrl:function(c,
a){return"http://"+b.user_name+".cartodb.com/tiles/"+b.table_name+"/"+a+"/"+c.x+"/"+c.y+".png?sql="+b.query+"&map_key="+(b.map_key||"")},tileSize:new google.maps.Size(256,256),name:b.query,description:!1};b.layer=new google.maps.ImageMapType(a);b.map.overlayMapTypes.insertAt(0,b.layer)}}function j(b){var c="http://"+b.user_name+".cartodb.com/tiles/"+b.table_name+"/{z}/{x}/{y}",a=c+".png?cache_buster=0",c=c+".grid.json";if(b.query)var e="sql="+b.query,a=wax.util.addUrlData(a,e),c=wax.util.addUrlData(c,
e);b.map_key&&(e="map_key="+b.map_key,a=wax.util.addUrlData(a,e),c=wax.util.addUrlData(c,e));return{blankImage:"blank_tile.png",tilejson:"1.0.0",scheme:"xyz",tiles:[a],grids:[c],tiles_base:a,grids_base:c,name:b.query,description:!0,formatter:function(c,b){return currentCartoDbId=b.cartodb_id},cache_buster:function(){return b.cache_buster}}}function i(b,c){if(c){var a=-1;b.overlayMapTypes.forEach(function(b,e){c==b&&b.name==c.name&&b.description==c.description&&(a=e)});-1!=a&&b.overlayMapTypes.removeAt(a);
c=null}}this.params=a;this.params.infowindow?e(this.params):g(this.params);this.params.map_style&&f(this.params);this.params.auto_bound&&d(this.params);this.params.visible=!0;this.params.active=!0;google.maps.CartoDBLayer.prototype.update=function(b){this.params.infowindow&&this.params.infowindow.hide();var c=this.params;if(c.infowindow)c.cache_buster++,c.query=b,c.tilejson=j(c),i(c.map,c.layer),c.tilejson.grids=wax.util.addUrlData(c.tilejson.grids_base,"cache_buster="+c.cache_buster),c.layer=new wax.g.connector(c.tilejson),
c.map.overlayMapTypes.insertAt(0,c.layer),c.interaction.remove(),c.interaction=wax.g.interaction(c.map,c.tilejson,c.waxOptions);h(this.params,b);this.params.active=!0;this.params.visible=!0};google.maps.CartoDBLayer.prototype.destroy=function(){i(this.params.map,this.params.layer);this.params.infowindow&&(this.params.interaction.remove(),this.params.infowindow.hide());this.params.active=!1};google.maps.CartoDBLayer.prototype.hide=function(){this.destroy();this.params.visible=!1};google.maps.CartoDBLayer.prototype.show=
function(){if(!this.params.visible||!this.params.active)this.update(this.params.query),this.params.visible=!0};google.maps.CartoDBLayer.prototype.isVisible=function(){return this.params.visible}};function CartoDBInfowindow(a){this.latlng_=new google.maps.LatLng(0,0);this.map_=a.map;this.offsetHorizontal_=-107;this.offsetHorizontal_=-191;this.width_=264;this.setMap(a.map);this.params_=a;this.getActiveColumns(a)}CartoDBInfowindow.prototype=new google.maps.OverlayView;
CartoDBInfowindow.prototype.getActiveColumns=function(a){function d(a){var e="";for(p in a)a[p]&&"the_geom_webmercator"!=p&&(e+=p+",");return e.substr(0,e.length-1)}var f=this;$.ajax({url:"http://"+a.user_name+".cartodb.com/tiles/"+a.table_name+"/infowindow?map_key="+(a.map_key||"")+"&callback=?",dataType:"jsonp",success:function(a){(a=$.parseJSON(a.infowindow))?f.columns_=d(a):$.ajax({method:"get",url:"http://"+f.params_.user_name+".cartodb.com/api/v1/sql/?q="+escape("select * from "+f.params_.table_name+
" LIMIT 1"),dataType:"jsonp",success:function(a){f.columns_=d(a.rows[0])},error:function(){}})},error:function(){}})};
CartoDBInfowindow.prototype.draw=function(){var a=this,d=this.div_;if(!d)d=this.div_=document.createElement("DIV"),d.className="cartodb_infowindow",d.innerHTML='<a href="#close" class="close">x</a><div class="outer_top"><div class="top"><p>Mortgages seriously delinquent or in foreclosure</p></div></div><div class="bottom"><label class="strong">21.0%</label><label class="box">ZIP CODE: 12212</label></div>',$(d).find("a.close").click(function(e){e.preventDefault();e.stopPropagation();a.hide()}),google.maps.event.addDomListener(d,
"click",function(a){a.preventDefault?a.preventDefault():a.returnValue=!1}),google.maps.event.addDomListener(d,"dblclick",function(a){a.preventDefault?a.preventDefault():a.returnValue=!1}),google.maps.event.addDomListener(d,"mousedown",function(a){a.preventDefault?a.preventDefault():a.returnValue=!1}),google.maps.event.addDomListener(d,"mouseup",function(a){a.preventDefault?a.preventDefault():a.returnValue=!1}),google.maps.event.addDomListener(d,"mousewheel",function(a){a.stopPropagation()}),google.maps.event.addDomListener(d,
"DOMMouseScroll",function(a){a.stopPropagation()}),this.getPanes().floatPane.appendChild(d),d.style.opacity=0;var f=this.getProjection().fromLatLngToDivPixel(this.latlng_);if(f){d.style.width=this.width_+"px";d.style.left=f.x+this.offsetHorizontal_+"px";var g=-$(d).height();d.style.top=f.y+g+5+"px"}};
CartoDBInfowindow.prototype.setPosition=function(){if(this.div_){var a=this.div_,d=this.getProjection().fromLatLngToDivPixel(this.latlng_);if(d){a.style.width=this.width_+"px";a.style.left=d.x+this.offsetHorizontal_+"px";var f=-$(a).height();a.style.top=d.y+f+10+"px"}this.show()}};
CartoDBInfowindow.prototype.open=function(a,d){var f=this;f.feature_=a;$.ajax({method:"get",url:"http://"+this.params_.user_name+".cartodb.com/api/v1/sql/?q="+escape("select "+f.columns_+" from "+this.params_.table_name+" where cartodb_id="+a)+"&callback=?",dataType:"jsonp",success:function(a){a=a.rows[0];if(f.div_){f.latlng_=d;var e,h;for(p in a)"zipcode"==p&&(e=a[p]),"percent_delinquent"==p&&(h=(100*a[p]).toFixed(1));$("div.cartodb_infowindow div.bottom label.strong").html(h+"%");$("div.cartodb_infowindow div.bottom label.box").html("ZIP CODE: "+
e);f.moveMaptoOpen();f.setPosition()}},error:function(){}})};CartoDBInfowindow.prototype.hide=function(){if(this.div_){var a=this.div_;$(a).animate({top:"+=10px",opacity:0},100,"swing",function(){a.style.visibility="hidden"})}};CartoDBInfowindow.prototype.show=function(){if(this.div_){var a=this.div_;a.style.opacity=0;a.style.visibility="visible";$(a).animate({top:"-=10px",opacity:1},250)}};CartoDBInfowindow.prototype.hideAll=function(){$("div.cartodb_infowindow").css("visibility","hidden")};
CartoDBInfowindow.prototype.isVisible=function(){return this.div_?"visible"==this.div_.style.visibility&&null!=this.feature_?!0:!1:!1};CartoDBInfowindow.prototype.transformGeoJSON=function(a){a=$.parseJSON(a);return new google.maps.LatLng(a.coordinates[1],a.coordinates[0])};
CartoDBInfowindow.prototype.moveMaptoOpen=function(){var a=0,d=0,f=this.div_,g=this.getProjection().fromLatLngToContainerPixel(this.latlng_);0>g.x+this.offsetHorizontal_&&(a=g.x+this.offsetHorizontal_-20);g.x+180>=$("#"+this.params_.map_canvas).width()&&(a=g.x+180-$("#"+this.params_.map_canvas).width());0>g.y-$(f).height()&&(d=g.y-$(f).height()-30);this.map_.panBy(a,d)};
