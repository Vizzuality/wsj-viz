function CartoShader(shader){this.compiled={};this.compile(shader)}CartoShader.prototype.compile=function(shader){if(typeof shader==="string")shader=eval("(function() { return "+shader+"; })()");var mapper={"point-color":"fillStyle","line-color":"strokeStyle","line-width":"lineWidth","polygon-fill":"fillStyle"};for(var attr in shader){var c=mapper[attr];if(c)this.compiled[c]=eval("(function() { return shader[attr]; })();")}};
CartoShader.prototype.apply=function(canvas_ctx,data,render_context){var shader=this.compiled;for(var attr in shader){var fn=shader[attr];if(typeof fn==="function")fn=fn(data,render_context);canvas_ctx[attr]=fn}};function shader_test(){};var TILE_SIZE=256;function bound(value,opt_min,opt_max){if(opt_min!=null)value=Math.max(value,opt_min);if(opt_max!=null)value=Math.min(value,opt_max);return value}function degreesToRadians(deg){return deg*(Math.PI/180)}function radiansToDegrees(rad){return rad/(Math.PI/180)}function MercatorProjection(){this.pixelOrigin_=new google.maps.Point(TILE_SIZE/2,TILE_SIZE/2);this.pixelsPerLonDegree_=TILE_SIZE/360;this.pixelsPerLonRadian_=TILE_SIZE/(2*Math.PI)}
MercatorProjection.prototype.fromLatLngToPoint=function(latLng,opt_point){var me=this;var point=opt_point||new google.maps.Point(0,0);var origin=me.pixelOrigin_;point.x=origin.x+latLng.lng()*me.pixelsPerLonDegree_;var siny=bound(Math.sin(degreesToRadians(latLng.lat())),-0.9999,0.9999);point.y=origin.y+0.5*Math.log((1+siny)/(1-siny))*-me.pixelsPerLonRadian_;return point};
MercatorProjection.prototype.fromPointToLatLng=function(point){var me=this;var origin=me.pixelOrigin_;var lng=(point.x-origin.x)/me.pixelsPerLonDegree_;var latRadians=(point.y-origin.y)/-me.pixelsPerLonRadian_;var lat=radiansToDegrees(2*Math.atan(Math.exp(latRadians))-Math.PI/2);return new google.maps.LatLng(lat,lng)};
MercatorProjection.prototype.tileBBox=function(x,y,zoom){var numTiles=1<<zoom;var inc=TILE_SIZE/numTiles;var px=x*TILE_SIZE/numTiles;var py=y*TILE_SIZE/numTiles;return[this.fromPointToLatLng(new google.maps.Point(px,py+inc)),this.fromPointToLatLng(new google.maps.Point(px+inc,py))]};MercatorProjection.prototype.tilePoint=function(x,y,zoom){var numTiles=1<<zoom;var px=x*TILE_SIZE;var py=y*TILE_SIZE;return[px,py]};
MercatorProjection.prototype.latLngToTilePoint=function(latLng,x,y,zoom){var numTiles=1<<zoom;var projection=this;var worldCoordinate=projection.fromLatLngToPoint(latLng);var pixelCoordinate=new google.maps.Point(worldCoordinate.x*numTiles,worldCoordinate.y*numTiles);var tp=this.tilePoint(x,y,zoom);return new google.maps.Point(Math.floor(pixelCoordinate.x-tp[0]),Math.floor(pixelCoordinate.y-tp[1]))};
MercatorProjection.prototype.latLngToTile=function(latLng,zoom){var numTiles=1<<zoom;var projection=this;var worldCoordinate=projection.fromLatLngToPoint(latLng);var pixelCoordinate=new google.maps.Point(worldCoordinate.x*numTiles,worldCoordinate.y*numTiles);return new google.maps.Point(Math.floor(pixelCoordinate.x/TILE_SIZE),Math.floor(pixelCoordinate.y/TILE_SIZE))};function CanvasTileLayer(canvas_setup){this.tileSize=new google.maps.Size(256,256);this.maxZoom=19;this.name="Tile #s";this.alt="Canvas tile layer";this.tiles={};this.canvas_setup=canvas_setup}
CanvasTileLayer.prototype.create_tile_canvas=function(coord,zoom,ownerDocument){var back_canvas=ownerDocument.createElement("canvas");var canvas=ownerDocument.createElement("canvas");var hit_canvas=ownerDocument.createElement("canvas");canvas.style.border=hit_canvas.style.border="none";canvas.style.margin=hit_canvas.style.margin="0";canvas.style.padding=hit_canvas.style.padding="0";back_canvas.style.border="none";back_canvas.style.margin="0";back_canvas.style.padding="0";back_canvas.style.display=
"none";var ctx=canvas.getContext("2d");ctx.width=canvas.width=this.tileSize.width;ctx.height=canvas.height=this.tileSize.height;var hit_ctx=hit_canvas.getContext("2d");hit_canvas.width=hit_ctx.width=this.tileSize.width;hit_canvas.height=hit_ctx.height=this.tileSize.height;var back_ctx=back_canvas.getContext("2d");back_ctx.width=back_canvas.width=this.tileSize.width;back_ctx.height=back_canvas.height=this.tileSize.height;var tile_id=coord.x+"_"+coord.y+"_"+zoom;canvas.setAttribute("id",tile_id);hit_canvas.setAttribute("id",
tile_id);if(tile_id in this.tiles)delete this.tiles[tile_id];this.tiles[tile_id]={canvas:canvas,ctx:ctx,hit_canvas:hit_canvas,hit_ctx:hit_ctx,coord:coord,zoom:zoom,primitives:null,back_ctx:back_ctx,back_canvas:back_canvas};if(this.canvas_setup)this.canvas_setup(this.tiles[tile_id],coord,zoom);return canvas};CanvasTileLayer.prototype.each=function(callback){for(var t in this.tiles){var tile=this.tiles[t];callback(tile)}};
CanvasTileLayer.prototype.flip=function(){for(var t in this.tiles){var tile=this.tiles[t];tile.canvas.width=tile.canvas.width;tile.ctx.drawImage(tile.back_canvas,0,0)}};CanvasTileLayer.prototype.redraw=function(){var self=this;for(var t in this.tiles){var tile=this.tiles[t];this.canvas_setup(tile,tile.coord,tile.zoom,function(){})}};CanvasTileLayer.prototype.getTile=function(coord,zoom,ownerDocument){return this.create_tile_canvas(coord,zoom,ownerDocument)};
CanvasTileLayer.prototype.releaseTile=function(tile){var id=tile.getAttribute("id");delete this.tiles[id]};function CartoDB(options){this.options=options;this.projection=new MercatorProjection;this.shader=new CartoShader(this.options.shader||'{ point-color: "#000" }');this.cache={};this.hit_shader=new CartoShader({"line-color":"#FFDA00","line-width":3,"polygon-fill":function(data,render_context){return"rgb("+Int2RGB(render_context.id).join(",")+")"}});if(options.user&&options.table){this.base_url="http://"+options.user+".cartodb.com/api/v2/sql";this._init_layer()}else throw Exception("CartoDB user and table must be specified");
}CartoDB.prototype.set_css=function(css){this.shader=new CartoShader(css);this.layer.redraw()};CartoDB.prototype.sql=function(sql,callback){var self=this;if(this.options.debug);data=this.cache[sql];if(data){callback(data);return}$.getJSON(this.base_url+"?q="+encodeURIComponent(sql)+"&format=geojson&dp=6",function(data){self.cache[sql]=data;callback(data)})};
CartoDB.prototype.tile_data=function(x,y,zoom,callback){var opts=this.options;var projection=new MercatorProjection;var bbox=projection.tileBBox(x,y,zoom);var geom_column="the_geom";var the_geom;if(zoom>=17)the_geom=geom_column;else if(zoom>=14)the_geom="ST_Simplify((ST_Dump("+geom_column+")).geom,0.0000005) as the_geom";else if(zoom>=10)the_geom="ST_Simplify((ST_Dump("+geom_column+")).geom,0.00005) as the_geom";else if(zoom>=6)the_geom="ST_Simplify((ST_Dump("+geom_column+")).geom,0.0005) as the_geom";
else{the_geom="ST_Simplify((ST_Dump("+geom_column+")).geom,0.0005) as the_geom";the_geom="ST_SnapToGrid("+geom_column+",0.0005) as the_geom"}var columns=[the_geom].concat(opts.columns).join(",");var ints="ST_SetSRID(ST_MakeBox2D(";ints+="ST_Point("+bbox[0].lng()+","+bbox[0].lat()+"),";ints+="ST_Point("+bbox[1].lng()+","+bbox[1].lat()+")), 4326)";var sql="select "+columns+" from "+opts.table+" WHERE the_geom && ";sql=sql+ints;if(this.options.where)sql+=" AND "+this.options.where;this.sql(sql,callback)};
function Renderer(){var self=this;var primitive_render=this.primitive_render={"Point":function(ctx,coordinates){ctx.save();var radius=2;var p=coordinates;ctx.translate(p.x,p.y);ctx.beginPath();ctx.arc(radius,radius,radius,0,Math.PI*2,true);ctx.closePath();ctx.fill();ctx.stroke();ctx.restore()},"MultiPoint":function(ctx,coordinates){var prender=primitive_render["Point"];for(var i=0;i<coordinates.length;++i)prender(ctx,zoom,coordinates[i])},"Polygon":function(ctx,coordinates){ctx.beginPath();var p=
coordinates[0][0];ctx.moveTo(p.x,p.y);for(var i=0;i<coordinates[0].length;++i){p=coordinates[0][i];ctx.lineTo(p.x,p.y)}ctx.closePath();ctx.fill();ctx.stroke()},"MultiPolygon":function(ctx,coordinates){var prender=primitive_render["Polygon"];for(var i=0;i<coordinates.length;++i)prender(ctx,coordinates[i])}}}
Renderer.prototype.render=function(ctx,primitives,coord,zoom,shader,hit){var primitive_render=this.primitive_render;ctx.canvas.width=ctx.canvas.width;var visible_only=new Array;var visible_only_i=new Array;if(primitives.length){for(var i=0;i<primitives.length;++i){var renderer=primitive_render[primitives[i].geometry.type];if(renderer){var render_context={zoom:zoom,id:i};if(primitives[i].properties.cartodb_id==-1){visible_only.push(primitives[i]);visible_only_i.push(i)}else{shader.apply(ctx,primitives[i].properties,
render_context);renderer(ctx,primitives[i].geometry.projected)}}}if(!hit)if(0<visible_only.length)for(var i=0;i<visible_only.length;++i){var renderer=primitive_render[visible_only[i].geometry.type];if(renderer){var render_context={zoom:zoom,id:visible_only_i[i]};shader.apply(ctx,visible_only[i].properties,render_context);renderer(ctx,visible_only[i].geometry.projected)}}}};
CartoDB.prototype.convert_geometry=function(geometry,zoom,x,y){var self=this;function map_latlon(latlng,x,y,zoom){latlng=new google.maps.LatLng(latlng[1],latlng[0]);return self.projection.latLngToTilePoint(latlng,x,y,zoom)}var primitive_conversion=this.primitive_conversion={"Point":function(x,y,zoom,coordinates){return map_latlon(coordinates,x,y,zoom)},"MultiPoint":function(x,y,zoom,coordinates){var converted=[];var pc=primitive_conversion["Point"];for(var i=0;i<coordinates.length;++i)converted.push(pc(x,
y,zoom,coordinates[i]));return converted},"Polygon":function(x,y,zoom,coordinates){var coords=[];for(var i=0;i<coordinates[0].length;++i)coords.push(map_latlon(coordinates[0][i],x,y,zoom));return[coords]},"MultiPolygon":function(x,y,zoom,coordinates){var polys=[];var pc=primitive_conversion["Polygon"];for(var i=0;i<coordinates.length;++i)polys.push(pc(x,y,zoom,coordinates[i]));return polys}};var conversor=this.primitive_conversion[geometry.type];if(conversor)return conversor(x,y,zoom,geometry.coordinates)};
CartoDB.prototype._init_layer=function(){var self=this;var r=new Renderer;r.projection=self.projection;this.layer=new CanvasTileLayer(function(tile_info,coord,zoom,ready){var ctx=tile_info.ctx;var hit_ctx=tile_info.hit_ctx;self.tile_data(coord.x,coord.y,zoom,function(data){var primitives=tile_info.primitives=data.features;for(var i=0;i<primitives.length;++i){var p=primitives[i];if(p.geometry.projected===undefined)p.geometry.projected=self.convert_geometry(p.geometry,zoom,coord.x,coord.y)}r.render(ctx,
primitives,coord,zoom,self.shader);r.render(hit_ctx,primitives,coord,zoom,self.hit_shader,true)})})};RGB2Int=function(r,g,b){return r+256*g+256*256*b};Int2RGB=function(input){var r=input%256;var g=parseInt(input/256)%256;var b=parseInt(input/256/256)%256;return[r,g,b]};var GeoJSON=function(geojson,options){var _geometryToGoogleMaps=function(geojsonGeometry,opts,geojsonProperties){var googleObj;switch(geojsonGeometry.type){case "Point":opts.position=new google.maps.LatLng(geojsonGeometry.coordinates[1],geojsonGeometry.coordinates[0]);googleObj=new google.maps.Marker(opts);if(geojsonProperties)googleObj.set("geojsonProperties",geojsonProperties);break;case "MultiPoint":googleObj=[];for(var i=0;i<geojsonGeometry.coordinates.length;i++){opts.position=new google.maps.LatLng(geojsonGeometry.coordinates[i][1],
geojsonGeometry.coordinates[i][0]);googleObj.push(new google.maps.Marker(opts))}if(geojsonProperties)for(var k=0;k<googleObj.length;k++)googleObj[k].set("geojsonProperties",geojsonProperties);break;case "LineString":var path=[];for(var i=0;i<geojsonGeometry.coordinates.length;i++){var coord=geojsonGeometry.coordinates[i];var ll=new google.maps.LatLng(coord[1],coord[0]);path.push(ll)}opts.path=path;googleObj=new google.maps.Polyline(opts);if(geojsonProperties)googleObj.set("geojsonProperties",geojsonProperties);
break;case "MultiLineString":googleObj=[];for(var i=0;i<geojsonGeometry.coordinates.length;i++){var path=[];for(var j=0;j<geojsonGeometry.coordinates[i].length;j++){var coord=geojsonGeometry.coordinates[i][j];var ll=new google.maps.LatLng(coord[1],coord[0]);path.push(ll)}opts.path=path;googleObj.push(new google.maps.Polyline(opts))}if(geojsonProperties)for(var k=0;k<googleObj.length;k++)googleObj[k].set("geojsonProperties",geojsonProperties);break;case "Polygon":var paths=[];for(var i=0;i<geojsonGeometry.coordinates.length;i++){var path=
[];for(var j=0;j<geojsonGeometry.coordinates[i].length;j++){var ll=new google.maps.LatLng(geojsonGeometry.coordinates[i][j][1],geojsonGeometry.coordinates[i][j][0]);path.push(ll)}paths.push(path)}opts.paths=paths;googleObj=new google.maps.Polygon(opts);if(geojsonProperties)googleObj.set("geojsonProperties",geojsonProperties);break;case "MultiPolygon":googleObj=[];for(var i=0;i<geojsonGeometry.coordinates.length;i++){var paths=[];for(var j=0;j<geojsonGeometry.coordinates[i].length;j++){var path=[];
for(var k=0;k<geojsonGeometry.coordinates[i][j].length;k++){var ll=new google.maps.LatLng(geojsonGeometry.coordinates[i][j][k][1],geojsonGeometry.coordinates[i][j][k][0]);path.push(ll)}paths.push(path)}opts.paths=paths;googleObj.push(new google.maps.Polygon(opts))}if(geojsonProperties)for(var k=0;k<googleObj.length;k++)googleObj[k].set("geojsonProperties",geojsonProperties);break;case "GeometryCollection":googleObj=[];if(!geojsonGeometry.geometries)googleObj=_error('Invalid GeoJSON object: GeometryCollection object missing "geometries" member.');
else for(var i=0;i<geojsonGeometry.geometries.length;i++)googleObj.push(_geometryToGoogleMaps(geojsonGeometry.geometries[i],opts,geojsonProperties||null));break;default:googleObj=_error('Invalid GeoJSON object: Geometry object must be one of "Point", "LineString", "Polygon" or "MultiPolygon".')}return googleObj};var _error=function(message){return{type:"Error",message:message}};var obj;var opts=options||{};switch(geojson.type){case "FeatureCollection":if(!geojson.features)obj=_error('Invalid GeoJSON object: FeatureCollection object missing "features" member.');
else{obj=[];for(var i=0;i<geojson.features.length;i++)obj.push(_geometryToGoogleMaps(geojson.features[i].geometry,opts,geojson.features[i].properties))}break;case "GeometryCollection":if(!geojson.geometries)obj=_error('Invalid GeoJSON object: GeometryCollection object missing "geometries" member.');else{obj=[];for(var i=0;i<geojson.geometries.length;i++)obj.push(_geometryToGoogleMaps(geojson.geometries[i],opts))}break;case "Feature":if(!(geojson.properties&&geojson.geometry))obj=_error('Invalid GeoJSON object: Feature object missing "properties" or "geometry" member.');
else obj=_geometryToGoogleMaps(geojson.geometry,opts,geojson.properties);break;case "Point":case "MultiPoint":case "LineString":case "MultiLineString":case "Polygon":case "MultiPolygon":obj=geojson.coordinates?obj=_geometryToGoogleMaps(geojson,opts):_error('Invalid GeoJSON object: Geometry object missing "coordinates" member.');break;default:obj=_error('Invalid GeoJSON object: GeoJSON object must be one of "Point", "LineString", "Polygon", "MultiPolygon", "Feature", "FeatureCollection" or "GeometryCollection".')}return obj};var CartoDBInfowindow=function(map){this.latlng_=new google.maps.LatLng(0,0);this.feature_;this.map_=map;this.columns_;this.width_=264;this.height_=124;this.offsetVertical_=-114;this.offsetHorizontal_=-191;this.setMap(map)};CartoDBInfowindow.prototype=new google.maps.OverlayView;
CartoDBInfowindow.prototype.draw=function(latlng,txt){var me=this;var div=this.div_;this.latlng_=latlng;if(!div){div=this.div_=document.createElement("div");div.setAttribute("class","cartodb_infowindow");google.maps.event.addDomListener(div,"click",function(ev){ev.preventDefault?ev.preventDefault():ev.returnValue=false});google.maps.event.addDomListener(div,"dblclick",function(ev){ev.preventDefault?ev.preventDefault():ev.returnValue=false});google.maps.event.addDomListener(div,"mousedown",function(ev){ev.preventDefault?
ev.preventDefault():ev.returnValue=false});google.maps.event.addDomListener(div,"mouseup",function(ev){ev.preventDefault?ev.preventDefault():ev.returnValue=false});google.maps.event.addDomListener(div,"mousewheel",function(ev){ev.stopPropagation()});google.maps.event.addDomListener(div,"DOMMouseScroll",function(ev){ev.stopPropagation()});var panes=this.getPanes();panes.floatPane.appendChild(div);div.style.opacity=0}if(txt){div.innerHTML=txt;$(div).find("a.close").unbind("click");$(div).find("a.close").click(function(evz){evz.preventDefault();
evz.stopPropagation();me.hide()})}var pixPosition=this.getProjection().fromLatLngToDivPixel(this.latlng_);if(pixPosition){div.style.width=this.width_+"px";div.style.left=pixPosition.x+this.offsetHorizontal_+"px";div.style.height=this.height_+"px";div.style.top=pixPosition.y+this.offsetVertical_+"px"}};CartoDBInfowindow.prototype.start=function(){if(this.div_){var div=this.div_;this.moveMaptoOpen();this.show()}};
CartoDBInfowindow.prototype.show=function(){if(this.div_){var div=this.div_;div.style.opacity=1;div.style.visibility="visible"}};CartoDBInfowindow.prototype.hide=function(){if(this.div_){var div=this.div_;$(div).animate({top:"+="+10+"px",opacity:0},100,"swing",function(){div.style.visibility="hidden"})}};CartoDBInfowindow.prototype.hideAll=function(){$("div.cartodb_infowindow").css("visibility","hidden")};
CartoDBInfowindow.prototype.moveMaptoOpen=function(){var left=0;var top=0;var div=this.div_;var pixPosition=this.getProjection().fromLatLngToContainerPixel(this.latlng_);if(pixPosition.x+this.offsetHorizontal_<0)left=pixPosition.x+this.offsetHorizontal_-20;if(pixPosition.x+this.width_+this.offsetHorizontal_>=$("#map_canvas").width())left=pixPosition.x+this.width_+this.offsetHorizontal_-$("#map_canvas").width();if(pixPosition.y-$(div).height()<0)top=pixPosition.y-$(div).height()-30;this.map_.panBy(left,
top)};!function(context,win){function serial(a){var b=a.name;if(a.disabled||!b)return"";b=enc(b);switch(a.tagName.toLowerCase()){case "input":switch(a.type){case "reset":case "button":case "image":case "file":return"";case "checkbox":case "radio":return a.checked?b+"="+(a.value?enc(a.value):!0)+"&":"";default:return b+"="+(a.value?enc(a.value):"")+"&"}break;case "textarea":return b+"="+enc(a.value)+"&";case "select":return b+"="+enc(a.options[a.selectedIndex].value)+"&"}return""}function enc(a){return encodeURIComponent(a)}
function reqwest(a,b){return new Reqwest(a,b)}function init(o,fn){function error(a){o.error&&o.error(a),complete(a)}function success(resp){o.timeout&&clearTimeout(self.timeout)&&(self.timeout=null);var r=resp.responseText;if(r)switch(type){case "json":resp=win.JSON?win.JSON.parse(r):eval("("+r+")");break;case "js":resp=eval(r);break;case "html":resp=r}fn(resp),o.success&&o.success(resp),complete(resp)}function complete(a){o.complete&&o.complete(a)}this.url=typeof o=="string"?o:o.url,this.timeout=
null;var type=o.type||setType(this.url),self=this;fn=fn||function(){},o.timeout&&(this.timeout=setTimeout(function(){self.abort(),error()},o.timeout)),this.request=getRequest(o,success,error)}function setType(a){if(/\.json$/.test(a))return"json";if(/\.jsonp$/.test(a))return"jsonp";if(/\.js$/.test(a))return"js";if(/\.html?$/.test(a))return"html";if(/\.xml$/.test(a))return"xml";return"js"}function Reqwest(a,b){this.o=a,this.fn=b,init.apply(this,arguments)}function getRequest(a,b,c){if(a.type!="jsonp"){var f=
xhr();f.open(a.method||"GET",typeof a=="string"?a:a.url,!0),setHeaders(f,a),f.onreadystatechange=handleReadyState(f,b,c),a.before&&a.before(f),f.send(a.data||null);return f}var d=doc.createElement("script"),e=0;win[getCallbackName(a)]=generalCallback,d.type="text/javascript",d.src=a.url,d.async=!0,d.onload=d.onreadystatechange=function(){if(d[readyState]&&d[readyState]!=="complete"&&d[readyState]!=="loaded"||e)return!1;d.onload=d.onreadystatechange=null,a.success&&a.success(lastValue),lastValue=undefined,
head.removeChild(d),e=1},head.appendChild(d)}function generalCallback(a){lastValue=a}function getCallbackName(a){var b=a.jsonpCallback||"callback";if(a.url.slice(-(b.length+2))==b+"=?"){var c="reqwest_"+uniqid++;a.url=a.url.substr(0,a.url.length-1)+c;return c}var d=new RegExp(b+"=([\\w]+)");return a.url.match(d)[1]}function setHeaders(a,b){var c=b.headers||{};c.Accept=c.Accept||"text/javascript, text/html, application/xml, text/xml, */*",b.crossOrigin||(c["X-Requested-With"]=c["X-Requested-With"]||
"XMLHttpRequest"),c[contentType]=c[contentType]||"application/x-www-form-urlencoded";for(var d in c)c.hasOwnProperty(d)&&a.setRequestHeader(d,c[d],!1)}function handleReadyState(a,b,c){return function(){a&&a[readyState]==4&&(twoHundo.test(a.status)?b(a):c(a))}}var twoHundo=/^20\d$/,doc=document,byTag="getElementsByTagName",readyState="readyState",contentType="Content-Type",head=doc[byTag]("head")[0],uniqid=0,lastValue,xhr="XMLHttpRequest"in win?function(){return new XMLHttpRequest}:function(){return new ActiveXObject("Microsoft.XMLHTTP")};
Reqwest.prototype={abort:function(){this.request.abort()},retry:function(){init.call(this,this.o,this.fn)}},reqwest.serialize=function(a){var b=[a[byTag]("input"),a[byTag]("select"),a[byTag]("textarea")],c=[],d,e;for(d=0,l=b.length;d<l;++d)for(e=0,l2=b[d].length;e<l2;++e)c.push(serial(b[d][e]));return c.join("").replace(/&$/,"")},reqwest.serializeArray=function(a){for(var b=this.serialize(a).split("&"),c=0,d=b.length,e=[],f;c<d;c++)b[c]&&(f=b[c].split("="))&&e.push({name:f[0],value:f[1]});return e};
var old=context.reqwest;reqwest.noConflict=function(){context.reqwest=old;return this},typeof module!="undefined"?module.exports=reqwest:context.reqwest=reqwest}(this,window);var html4={};html4.atype={NONE:0,URI:1,URI_FRAGMENT:11,SCRIPT:2,STYLE:3,ID:4,IDREF:5,IDREFS:6,GLOBAL_NAME:7,LOCAL_NAME:8,CLASSES:9,FRAME_TARGET:10};
html4.ATTRIBS={"*::class":9,"*::dir":0,"*::id":4,"*::lang":0,"*::onclick":2,"*::ondblclick":2,"*::onkeydown":2,"*::onkeypress":2,"*::onkeyup":2,"*::onload":2,"*::onmousedown":2,"*::onmousemove":2,"*::onmouseout":2,"*::onmouseover":2,"*::onmouseup":2,"*::style":3,"*::title":0,"a::accesskey":0,"a::coords":0,"a::href":1,"a::hreflang":0,"a::name":7,"a::onblur":2,"a::onfocus":2,"a::rel":0,"a::rev":0,"a::shape":0,"a::tabindex":0,"a::target":10,"a::type":0,"area::accesskey":0,"area::alt":0,"area::coords":0,
"area::href":1,"area::nohref":0,"area::onblur":2,"area::onfocus":2,"area::shape":0,"area::tabindex":0,"area::target":10,"bdo::dir":0,"blockquote::cite":1,"br::clear":0,"button::accesskey":0,"button::disabled":0,"button::name":8,"button::onblur":2,"button::onfocus":2,"button::tabindex":0,"button::type":0,"button::value":0,"canvas::height":0,"canvas::width":0,"caption::align":0,"col::align":0,"col::char":0,"col::charoff":0,"col::span":0,"col::valign":0,"col::width":0,"colgroup::align":0,"colgroup::char":0,
"colgroup::charoff":0,"colgroup::span":0,"colgroup::valign":0,"colgroup::width":0,"del::cite":1,"del::datetime":0,"dir::compact":0,"div::align":0,"dl::compact":0,"font::color":0,"font::face":0,"font::size":0,"form::accept":0,"form::action":1,"form::autocomplete":0,"form::enctype":0,"form::method":0,"form::name":7,"form::onreset":2,"form::onsubmit":2,"form::target":10,"h1::align":0,"h2::align":0,"h3::align":0,"h4::align":0,"h5::align":0,"h6::align":0,"hr::align":0,"hr::noshade":0,"hr::size":0,"hr::width":0,
"iframe::align":0,"iframe::frameborder":0,"iframe::height":0,"iframe::marginheight":0,"iframe::marginwidth":0,"iframe::width":0,"img::align":0,"img::alt":0,"img::border":0,"img::height":0,"img::hspace":0,"img::ismap":0,"img::name":7,"img::src":1,"img::usemap":11,"img::vspace":0,"img::width":0,"input::accept":0,"input::accesskey":0,"input::align":0,"input::alt":0,"input::autocomplete":0,"input::checked":0,"input::disabled":0,"input::ismap":0,"input::maxlength":0,"input::name":8,"input::onblur":2,"input::onchange":2,
"input::onfocus":2,"input::onselect":2,"input::readonly":0,"input::size":0,"input::src":1,"input::tabindex":0,"input::type":0,"input::usemap":11,"input::value":0,"ins::cite":1,"ins::datetime":0,"label::accesskey":0,"label::for":5,"label::onblur":2,"label::onfocus":2,"legend::accesskey":0,"legend::align":0,"li::type":0,"li::value":0,"map::name":7,"menu::compact":0,"ol::compact":0,"ol::start":0,"ol::type":0,"optgroup::disabled":0,"optgroup::label":0,"option::disabled":0,"option::label":0,"option::selected":0,
"option::value":0,"p::align":0,"pre::width":0,"q::cite":1,"select::disabled":0,"select::multiple":0,"select::name":8,"select::onblur":2,"select::onchange":2,"select::onfocus":2,"select::size":0,"select::tabindex":0,"table::align":0,"table::bgcolor":0,"table::border":0,"table::cellpadding":0,"table::cellspacing":0,"table::frame":0,"table::rules":0,"table::summary":0,"table::width":0,"tbody::align":0,"tbody::char":0,"tbody::charoff":0,"tbody::valign":0,"td::abbr":0,"td::align":0,"td::axis":0,"td::bgcolor":0,
"td::char":0,"td::charoff":0,"td::colspan":0,"td::headers":6,"td::height":0,"td::nowrap":0,"td::rowspan":0,"td::scope":0,"td::valign":0,"td::width":0,"textarea::accesskey":0,"textarea::cols":0,"textarea::disabled":0,"textarea::name":8,"textarea::onblur":2,"textarea::onchange":2,"textarea::onfocus":2,"textarea::onselect":2,"textarea::readonly":0,"textarea::rows":0,"textarea::tabindex":0,"tfoot::align":0,"tfoot::char":0,"tfoot::charoff":0,"tfoot::valign":0,"th::abbr":0,"th::align":0,"th::axis":0,"th::bgcolor":0,
"th::char":0,"th::charoff":0,"th::colspan":0,"th::headers":6,"th::height":0,"th::nowrap":0,"th::rowspan":0,"th::scope":0,"th::valign":0,"th::width":0,"thead::align":0,"thead::char":0,"thead::charoff":0,"thead::valign":0,"tr::align":0,"tr::bgcolor":0,"tr::char":0,"tr::charoff":0,"tr::valign":0,"ul::compact":0,"ul::type":0};html4.eflags={OPTIONAL_ENDTAG:1,EMPTY:2,CDATA:4,RCDATA:8,UNSAFE:16,FOLDABLE:32,SCRIPT:64,STYLE:128};
html4.ELEMENTS={"a":0,"abbr":0,"acronym":0,"address":0,"applet":16,"area":2,"b":0,"base":18,"basefont":18,"bdo":0,"big":0,"blockquote":0,"body":49,"br":2,"button":0,"canvas":0,"caption":0,"center":0,"cite":0,"code":0,"col":2,"colgroup":1,"dd":1,"del":0,"dfn":0,"dir":0,"div":0,"dl":0,"dt":1,"em":0,"fieldset":0,"font":0,"form":0,"frame":18,"frameset":16,"h1":0,"h2":0,"h3":0,"h4":0,"h5":0,"h6":0,"head":49,"hr":2,"html":49,"i":0,"iframe":4,"img":2,"input":2,"ins":0,"isindex":18,"kbd":0,"label":0,"legend":0,
"li":1,"link":18,"map":0,"menu":0,"meta":18,"nobr":0,"noembed":4,"noframes":20,"noscript":20,"object":16,"ol":0,"optgroup":0,"option":1,"p":1,"param":18,"pre":0,"q":0,"s":0,"samp":0,"script":84,"select":0,"small":0,"span":0,"strike":0,"strong":0,"style":148,"sub":0,"sup":0,"table":0,"tbody":1,"td":1,"textarea":8,"tfoot":1,"th":1,"thead":1,"title":24,"tr":1,"tt":0,"u":0,"ul":0,"var":0};html4.ueffects={NOT_LOADED:0,SAME_DOCUMENT:1,NEW_DOCUMENT:2};
html4.URIEFFECTS={"a::href":2,"area::href":2,"blockquote::cite":0,"body::background":1,"del::cite":0,"form::action":2,"img::src":1,"input::src":1,"ins::cite":0,"q::cite":0};html4.ltypes={UNSANDBOXED:2,SANDBOXED:1,DATA:0};html4.LOADERTYPES={"a::href":2,"area::href":2,"blockquote::cite":2,"body::background":1,"del::cite":2,"form::action":2,"img::src":1,"input::src":1,"ins::cite":2,"q::cite":2};
var html=function(html4){var lcase;if("script"==="SCRIPT".toLowerCase())lcase=function(s){return s.toLowerCase()};else lcase=function(s){return s.replace(/[A-Z]/g,function(ch){return String.fromCharCode(ch.charCodeAt(0)|32)})};var ENTITIES={lt:"<",gt:">",amp:"&",nbsp:"\u00a0",quot:'"',apos:"'"};var WHITELISTED_SCHEMES=/^(?:https?|mailto|data)$/i;var decimalEscapeRe=/^#(\d+)$/;var hexEscapeRe=/^#x([0-9A-Fa-f]+)$/;function lookupEntity(name){name=lcase(name);if(ENTITIES.hasOwnProperty(name))return ENTITIES[name];
var m=name.match(decimalEscapeRe);if(m)return String.fromCharCode(parseInt(m[1],10));else if(!!(m=name.match(hexEscapeRe)))return String.fromCharCode(parseInt(m[1],16));return""}function decodeOneEntity(_,name){return lookupEntity(name)}var nulRe=/\0/g;function stripNULs(s){return s.replace(nulRe,"")}var entityRe=/&(#\d+|#x[0-9A-Fa-f]+|\w+);/g;function unescapeEntities(s){return s.replace(entityRe,decodeOneEntity)}var ampRe=/&/g;var looseAmpRe=/&([^a-z#]|#(?:[^0-9x]|x(?:[^0-9a-f]|$)|$)|$)/gi;var ltRe=
/</g;var gtRe=/>/g;var quotRe=/\"/g;var eqRe=/\=/g;function escapeAttrib(s){return s.replace(ampRe,"&amp;").replace(ltRe,"&lt;").replace(gtRe,"&gt;").replace(quotRe,"&#34;").replace(eqRe,"&#61;")}function normalizeRCData(rcdata){return rcdata.replace(looseAmpRe,"&amp;$1").replace(ltRe,"&lt;").replace(gtRe,"&gt;")}var INSIDE_TAG_TOKEN=new RegExp("^\\s*(?:"+("(?:"+"([a-z][a-z-]*)"+("("+"\\s*=\\s*"+("("+'"[^"]*"'+"|'[^']*'"+"|(?=[a-z][a-z-]*\\s*=)"+"|[^>\"'\\s]*"+")")+")")+"?"+")")+"|(/?>)"+"|[\\s\\S][^a-z\\s>]*)",
"i");var OUTSIDE_TAG_TOKEN=new RegExp("^(?:"+"&(\\#[0-9]+|\\#[x][0-9a-f]+|\\w+);"+"|<\!--[\\s\\S]*?--\>|<!\\w[^>]*>|<\\?[^>*]*>"+"|<(/)?([a-z][a-z0-9]*)"+"|([^<&>]+)"+"|([<&>]))","i");function makeSaxParser(handler){return function parse(htmlText,param){htmlText=String(htmlText);var htmlLower=null;var inTag=false;var attribs=[];var tagName=void 0;var eflags=void 0;var openTag=void 0;if(handler.startDoc)handler.startDoc(param);while(htmlText){var m=htmlText.match(inTag?INSIDE_TAG_TOKEN:OUTSIDE_TAG_TOKEN);
htmlText=htmlText.substring(m[0].length);if(inTag)if(m[1]){var attribName=lcase(m[1]);var decodedValue;if(m[2]){var encodedValue=m[3];switch(encodedValue.charCodeAt(0)){case 34:case 39:encodedValue=encodedValue.substring(1,encodedValue.length-1);break}decodedValue=unescapeEntities(stripNULs(encodedValue))}else decodedValue=attribName;attribs.push(attribName,decodedValue)}else{if(m[4]){if(eflags!==void 0)if(openTag){if(handler.startTag)handler.startTag(tagName,attribs,param)}else if(handler.endTag)handler.endTag(tagName,
param);if(openTag&&eflags&(html4.eflags.CDATA|html4.eflags.RCDATA)){if(htmlLower===null)htmlLower=lcase(htmlText);else htmlLower=htmlLower.substring(htmlLower.length-htmlText.length);var dataEnd=htmlLower.indexOf("</"+tagName);if(dataEnd<0)dataEnd=htmlText.length;if(dataEnd){if(eflags&html4.eflags.CDATA){if(handler.cdata)handler.cdata(htmlText.substring(0,dataEnd),param)}else if(handler.rcdata)handler.rcdata(normalizeRCData(htmlText.substring(0,dataEnd)),param);htmlText=htmlText.substring(dataEnd)}}tagName=
eflags=openTag=void 0;attribs.length=0;inTag=false}}else if(m[1]){if(handler.pcdata)handler.pcdata(m[0],param)}else if(m[3]){openTag=!m[2];inTag=true;tagName=lcase(m[3]);eflags=html4.ELEMENTS.hasOwnProperty(tagName)?html4.ELEMENTS[tagName]:void 0}else if(m[4]){if(handler.pcdata)handler.pcdata(m[4],param)}else if(m[5])if(handler.pcdata){var ch=m[5];handler.pcdata(ch==="<"?"&lt;":ch===">"?"&gt;":"&amp;",param)}}if(handler.endDoc)handler.endDoc(param)}}function makeHtmlSanitizer(sanitizeAttributes){var stack;
var ignoring;return makeSaxParser({startDoc:function(_){stack=[];ignoring=false},startTag:function(tagName,attribs,out){if(ignoring)return;if(!html4.ELEMENTS.hasOwnProperty(tagName))return;var eflags=html4.ELEMENTS[tagName];if(eflags&html4.eflags.FOLDABLE)return;else if(eflags&html4.eflags.UNSAFE){ignoring=!(eflags&html4.eflags.EMPTY);return}attribs=sanitizeAttributes(tagName,attribs);if(attribs){if(!(eflags&html4.eflags.EMPTY))stack.push(tagName);out.push("<",tagName);for(var i=0,n=attribs.length;i<
n;i+=2){var attribName=attribs[i],value=attribs[i+1];if(value!==null&&value!==void 0)out.push(" ",attribName,'="',escapeAttrib(value),'"')}out.push(">")}},endTag:function(tagName,out){if(ignoring){ignoring=false;return}if(!html4.ELEMENTS.hasOwnProperty(tagName))return;var eflags=html4.ELEMENTS[tagName];if(!(eflags&(html4.eflags.UNSAFE|html4.eflags.EMPTY|html4.eflags.FOLDABLE))){var index;if(eflags&html4.eflags.OPTIONAL_ENDTAG)for(index=stack.length;--index>=0;){var stackEl=stack[index];if(stackEl===
tagName)break;if(!(html4.ELEMENTS[stackEl]&html4.eflags.OPTIONAL_ENDTAG))return}else for(index=stack.length;--index>=0;)if(stack[index]===tagName)break;if(index<0)return;for(var i=stack.length;--i>index;){var stackEl=stack[i];if(!(html4.ELEMENTS[stackEl]&html4.eflags.OPTIONAL_ENDTAG))out.push("</",stackEl,">")}stack.length=index;out.push("</",tagName,">")}},pcdata:function(text,out){if(!ignoring)out.push(text)},rcdata:function(text,out){if(!ignoring)out.push(text)},cdata:function(text,out){if(!ignoring)out.push(text)},
endDoc:function(out){for(var i=stack.length;--i>=0;)out.push("</",stack[i],">");stack.length=0}})}var URI_SCHEME_RE=new RegExp("^"+"(?:"+"([^:/?#]+)"+":)?");function sanitize(htmlText,opt_uriPolicy,opt_nmTokenPolicy){var out=[];makeHtmlSanitizer(function sanitizeAttribs(tagName,attribs){for(var i=0;i<attribs.length;i+=2){var attribName=attribs[i];var value=attribs[i+1];var atype=null,attribKey;if((attribKey=tagName+"::"+attribName,html4.ATTRIBS.hasOwnProperty(attribKey))||(attribKey="*::"+attribName,
html4.ATTRIBS.hasOwnProperty(attribKey)))atype=html4.ATTRIBS[attribKey];if(atype!==null)switch(atype){case html4.atype.NONE:break;case html4.atype.SCRIPT:case html4.atype.STYLE:value=null;break;case html4.atype.ID:case html4.atype.IDREF:case html4.atype.IDREFS:case html4.atype.GLOBAL_NAME:case html4.atype.LOCAL_NAME:case html4.atype.CLASSES:value=opt_nmTokenPolicy?opt_nmTokenPolicy(value):value;break;case html4.atype.URI:var parsedUri=(""+value).match(URI_SCHEME_RE);if(!parsedUri)value=null;else if(!parsedUri[1]||
WHITELISTED_SCHEMES.test(parsedUri[1]))value=opt_uriPolicy&&opt_uriPolicy(value);else value=null;break;case html4.atype.URI_FRAGMENT:if(value&&"#"===value.charAt(0)){value=opt_nmTokenPolicy?opt_nmTokenPolicy(value):value;if(value)value="#"+value}else value=null;break;default:value=null;break}else value=null;attribs[i+1]=value}return attribs})(htmlText,out);return out.join("")}return{escapeAttrib:escapeAttrib,makeHtmlSanitizer:makeHtmlSanitizer,makeSaxParser:makeSaxParser,normalizeRCData:normalizeRCData,
sanitize:sanitize,unescapeEntities:unescapeEntities}}(html4);var html_sanitize=html.sanitize;if(typeof window!=="undefined"){window["html"]=html;window["html_sanitize"]=html_sanitize}html4.ATTRIBS["*::style"]=0;html4.ELEMENTS["style"]=0;
var Mustache=function(){var regexCache={};var Renderer=function(){};Renderer.prototype={otag:"{{",ctag:"}}",pragmas:{},buffer:[],pragmas_implemented:{"IMPLICIT-ITERATOR":true},context:{},render:function(template,context,partials,in_recursion){if(!in_recursion){this.context=context;this.buffer=[]}if(!this.includes("",template))if(in_recursion)return template;else{this.send(template);return}template=this.render_pragmas(template);var html=this.render_section(template,context,partials);if(html===false)html=
this.render_tags(template,context,partials,in_recursion);if(in_recursion)return html;else this.sendLines(html)},send:function(line){if(line!=="")this.buffer.push(line)},sendLines:function(text){if(text){var lines=text.split("\n");for(var i=0;i<lines.length;i++)this.send(lines[i])}},render_pragmas:function(template){if(!this.includes("%",template))return template;var that=this;var regex=this.getCachedRegex("render_pragmas",function(otag,ctag){return new RegExp(otag+"%([\\w-]+) ?([\\w]+=[\\w]+)?"+ctag,
"g")});return template.replace(regex,function(match,pragma,options){if(!that.pragmas_implemented[pragma])throw{message:"This implementation of mustache doesn't understand the '"+pragma+"' pragma"};that.pragmas[pragma]={};if(options){var opts=options.split("=");that.pragmas[pragma][opts[0]]=opts[1]}return""})},render_partial:function(name,context,partials){name=this.trim(name);if(!partials||partials[name]===undefined)throw{message:"unknown_partial '"+name+"'"};if(typeof context[name]!="object")return this.render(partials[name],
context,partials,true);return this.render(partials[name],context[name],partials,true)},render_section:function(template,context,partials){if(!this.includes("#",template)&&!this.includes("^",template))return false;var that=this;var regex=this.getCachedRegex("render_section",function(otag,ctag){return new RegExp("^([\\s\\S]*?)"+otag+"(\\^|\\#)\\s*(.+)\\s*"+ctag+"\n*([\\s\\S]*?)"+otag+"\\/\\s*\\3\\s*"+ctag+"\\s*([\\s\\S]*)$","g")});return template.replace(regex,function(match,before,type,name,content,
after){var renderedBefore=before?that.render_tags(before,context,partials,true):"",renderedAfter=after?that.render(after,context,partials,true):"",renderedContent,value=that.find(name,context);if(type==="^")if(!value||that.is_array(value)&&value.length===0)renderedContent=that.render(content,context,partials,true);else renderedContent="";else if(type==="#")if(that.is_array(value))renderedContent=that.map(value,function(row){return that.render(content,that.create_context(row),partials,true)}).join("");
else if(that.is_object(value))renderedContent=that.render(content,that.create_context(value),partials,true);else if(typeof value==="function")renderedContent=value.call(context,content,function(text){return that.render(text,context,partials,true)});else if(value)renderedContent=that.render(content,context,partials,true);else renderedContent="";return renderedBefore+renderedContent+renderedAfter})},render_tags:function(template,context,partials,in_recursion){var that=this;var new_regex=function(){return that.getCachedRegex("render_tags",
function(otag,ctag){return new RegExp(otag+"(=|!|>|\\{|%)?([^\\/#\\^]+?)\\1?"+ctag+"+","g")})};var regex=new_regex();var tag_replace_callback=function(match,operator,name){switch(operator){case "!":return"";case "=":that.set_delimiters(name);regex=new_regex();return"";case ">":return that.render_partial(name,context,partials);case "{":return that.find(name,context);default:return that.escape(that.find(name,context))}};var lines=template.split("\n");for(var i=0;i<lines.length;i++){lines[i]=lines[i].replace(regex,
tag_replace_callback,this);if(!in_recursion)this.send(lines[i])}if(in_recursion)return lines.join("\n")},set_delimiters:function(delimiters){var dels=delimiters.split(" ");this.otag=this.escape_regex(dels[0]);this.ctag=this.escape_regex(dels[1])},escape_regex:function(text){if(!arguments.callee.sRE){var specials=["/",".","*","+","?","|","(",")","[","]","{","}","\\"];arguments.callee.sRE=new RegExp("(\\"+specials.join("|\\")+")","g")}return text.replace(arguments.callee.sRE,"\\$1")},find:function(name,
context){name=this.trim(name);function is_kinda_truthy(bool){return bool===false||bool===0||bool}var value;if(is_kinda_truthy(context[name]))value=context[name];else if(is_kinda_truthy(this.context[name]))value=this.context[name];if(typeof value==="function")return value.apply(context);if(value!==undefined)return value;return""},includes:function(needle,haystack){return haystack.indexOf(this.otag+needle)!=-1},escape:function(s){s=String(s===null?"":s);return s.replace(/&(?!\w+;)|["'<>\\]/g,function(s){switch(s){case "&":return"&amp;";
case '"':return"&quot;";case "'":return"&#39;";case "<":return"&lt;";case ">":return"&gt;";default:return s}})},create_context:function(_context){if(this.is_object(_context))return _context;else{var iterator=".";if(this.pragmas["IMPLICIT-ITERATOR"])iterator=this.pragmas["IMPLICIT-ITERATOR"].iterator;var ctx={};ctx[iterator]=_context;return ctx}},is_object:function(a){return a&&typeof a=="object"},is_array:function(a){return Object.prototype.toString.call(a)==="[object Array]"},trim:function(s){return s.replace(/^\s*|\s*$/g,
"")},map:function(array,fn){if(typeof array.map=="function")return array.map(fn);else{var r=[];var l=array.length;for(var i=0;i<l;i++)r.push(fn(array[i]));return r}},getCachedRegex:function(name,generator){var byOtag=regexCache[this.otag];if(!byOtag)byOtag=regexCache[this.otag]={};var byCtag=byOtag[this.ctag];if(!byCtag)byCtag=byOtag[this.ctag]={};var regex=byCtag[name];if(!regex)regex=byCtag[name]=generator(this.otag,this.ctag);return regex}};return{name:"mustache.js",version:"0.4.0-dev",to_html:function(template,
view,partials,send_fun){var renderer=new Renderer;if(send_fun)renderer.send=send_fun;renderer.render(template,view||{},partials);if(!send_fun)return renderer.buffer.join("\n")}}}();wax=wax||{};
wax.attribution=function(){var container,a={};function urlX(url){if(/^(https?:\/\/|data:image)/.test(url))return url}function idX(id){return id}a.set=function(content){if(typeof content==="undefined")return;container.innerHTML=html_sanitize(content,urlX,idX);return this};a.element=function(){return container};a.init=function(){container=document.createElement("div");container.className="wax-attribution";return this};return a.init()};wax=wax||{};
wax.bwdetect=function(options,callback){var detector={},threshold=options.threshold||400,testImage="http://a.tiles.mapbox.com/mapbox/1.0.0/blue-marble-topo-bathy-jul/0/0/0.png?preventcache="+ +new Date,bw=1,auto=options.auto===undefined?true:options.auto;function bwTest(){wax.bw=-1;var im=new Image;im.src=testImage;var first=true;var timeout=setTimeout(function(){if(first&&wax.bw==-1){detector.bw(0);first=false}},threshold);im.onload=function(){if(first&&wax.bw==-1){clearTimeout(timeout);detector.bw(1);
first=false}}}detector.bw=function(x){if(!arguments.length)return bw;var oldBw=bw;if(wax.bwlisteners&&wax.bwlisteners.length)(function(){listeners=wax.bwlisteners;wax.bwlisteners=[];for(i=0;i<listeners;i++)listeners[i](x)})();wax.bw=x;if(bw!=(bw=x))callback(x)};detector.add=function(){if(auto)bwTest();return this};if(wax.bw==-1){wax.bwlisteners=wax.bwlisteners||[];wax.bwlisteners.push(detector.bw)}else if(wax.bw!==undefined)detector.bw(wax.bw);else detector.add();return detector};
wax.formatter=function(x){var formatter={},f;if(x&&typeof x==="string")try{eval("f = "+x)}catch(e){if(console)console.log(e)}else if(x&&typeof x==="function")f=x;else f=function(){};function urlX(url){if(/^(https?:\/\/|data:image)/.test(url))return url}function idX(id){return id}formatter.format=function(options,data){try{return html_sanitize(f(options,data),urlX,idX)}catch(e){if(console)console.log(e)}};return formatter};
wax.GridInstance=function(grid_tile,formatter,options){options=options||{};var instance={},resolution=options.resolution||4,tileSize=options.tileSize||256;function resolveCode(key){if(key>=93)key--;if(key>=35)key--;key-=32;return key}instance.grid_tile=function(){return grid_tile};instance.getKey=function(x,y){if(!(grid_tile&&grid_tile.grid))return;if(y<0||x<0)return;if(Math.floor(y)>=tileSize||Math.floor(x)>=tileSize)return;return resolveCode(grid_tile.grid[Math.floor(y/resolution)].charCodeAt(Math.floor(x/
resolution)))};instance.gridFeature=function(x,y){var key=this.getKey(x,y),keys=grid_tile.keys;if(keys&&keys[key]&&grid_tile.data[keys[key]])return grid_tile.data[keys[key]]};instance.tileFeature=function(x,y,tile_element,options){if(!grid_tile)return;var offset=wax.util.offset(tile_element);feature=this.gridFeature(x-offset.left,y-offset.top);if(feature)return formatter.format(options,feature)};return instance};
wax.GridManager=function(options){options=options||{};var resolution=options.resolution||4,version=options.version||"1.1",grid_tiles={},manager={},formatter;var gridUrl=function(url){return url.replace(/(\.png|\.jpg|\.jpeg)(\d*)/,".grid.json")};function templatedGridUrl(template){if(typeof template==="string")template=[template];return function templatedGridFinder(url){if(!url)return;var xyz=/(\d+)\/(\d+)\/(\d+)\.[\w\._]+/g.exec(url);if(!xyz)return;return template[parseInt(xyz[2],10)%template.length].replace("{z}",
xyz[1]).replace("{x}",xyz[2]).replace("{y}",xyz[3])}}manager.formatter=function(x){if(!arguments.length)return formatter;formatter=wax.formatter(x);return manager};manager.template=function(x){if(!arguments.length)return formatter;formatter=wax.template(x);return manager};manager.gridUrl=function(x){if(!arguments.length)return gridUrl;gridUrl=typeof x==="function"?x:templatedGridUrl(x);return manager};manager.getGrid=function(url,callback){var gurl=gridUrl(url);if(!formatter||!gurl)return callback(null,
null);wax.request.get(gurl,function(err,t){if(err)return callback(err,null);callback(null,wax.GridInstance(t,formatter,{resolution:resolution||4}))});return manager};manager.add=function(options){if(options.template)manager.template(options.template);else if(options.formatter)manager.formatter(options.formatter);if(options.grids)manager.gridUrl(options.grids);return this};return manager.add(options)};wax=wax||{};
wax.hash=function(options){options=options||{};function getState(){return location.hash.substring(1)}function pushState(state){location.hash="#"+state}var s0,hash={},lat=90-1.0E-8;function parseHash(s){var args=s.split("/");for(var i=0;i<args.length;i++){args[i]=Number(args[i]);if(isNaN(args[i]))return true}if(args.length<3)return true;else if(args.length==3)options.setCenterZoom(args)}function move(){var s1=options.getCenterZoom();if(s0!==s1){s0=s1;pushState(s0)}}function stateChange(state){if(state===
s0)return;if(parseHash(s0=state))move()}var _move=wax.util.throttle(move,500);hash.add=function(){stateChange(getState());options.bindChange(_move);return this};hash.remove=function(){options.unbindChange(_move);return this};return hash.add()};var wax=wax||{};
wax.legend=function(){var element,legend={},container;function urlX(url){if(/^(https?:\/\/|data:image)/.test(url))return url}function idX(id){return id}legend.element=function(){return container};legend.content=function(content){if(!arguments.length)return element.innerHTML;if(content){element.innerHTML=html_sanitize(content,urlX,idX);element.style.display="block"}else{element.innerHTML="";element.style.display="none"}return this};legend.add=function(){container=document.createElement("div");container.className=
"wax-legends";element=document.createElement("div");element.className="wax-legend";element.style.display="none";container.appendChild(element);return this};return legend.add()};var w=function(self){self.melt=function(func,obj){return func.apply(obj,[self,obj])};return self};var wax=wax||{};wax.movetip={};
wax.movetip=function(options){options=options||{};var t={},_currentTooltip=undefined,_context=undefined,_animationOut=options.animationOut,_animationIn=options.animationIn;function isPopup(el){return el&&el.className.indexOf("wax-popup")!==-1}function getTooltip(feature,context){var tooltip=document.createElement("div");tooltip.className="wax-movetip";tooltip.style.cssText="position:absolute;";tooltip.innerHTML=feature;context.appendChild(tooltip);_context=context;_tooltipOffset=wax.util.offset(tooltip);
_contextOffset=wax.util.offset(_context);return tooltip}function moveTooltip(e){if(!_currentTooltip)return;var eo=wax.util.eventoffset(e);_currentTooltip.className="wax-movetip";if(_tooltipOffset.height+eo.y>_contextOffset.top+_contextOffset.height&&_contextOffset.height>_tooltipOffset.height){eo.y-=_tooltipOffset.height;_currentTooltip.className+=" flip-y"}if(_tooltipOffset.width+eo.x>_contextOffset.left+_contextOffset.width){eo.x-=_tooltipOffset.width;_currentTooltip.className+=" flip-x"}_currentTooltip.style.left=
eo.x+"px";_currentTooltip.style.top=eo.y+"px"}function hideTooltip(el){if(!el)return;var event,remove=function(){if(this.parentNode)this.parentNode.removeChild(this)};if(el.style["-webkit-transition"]!==undefined&&_animationOut)event="webkitTransitionEnd";else if(el.style.MozTransition!==undefined&&_animationOut)event="transitionend";if(event){el.addEventListener(event,remove,false);el.addEventListener("transitionend",remove,false);el.className+=" "+_animationOut}else if(el.parentNode)el.parentNode.removeChild(el)}
function click(feature,context){if(_currentTooltip){hideTooltip(_currentTooltip);_currentTooltip=undefined}var tooltip=getTooltip(feature,context);tooltip.className+=" wax-popup";tooltip.innerHTML=feature;var close=document.createElement("a");close.href="#close";close.className="close";close.innerHTML="Close";tooltip.appendChild(close);var closeClick=function(ev){hideTooltip(tooltip);_currentTooltip=undefined;ev.returnValue=false;if(ev.stopPropagation)ev.stopPropagation();if(ev.preventDefault)ev.preventDefault();
return false};if(close.addEventListener)close.addEventListener("click",closeClick,false);else if(close.attachEvent)close.attachEvent("onclick",closeClick);_currentTooltip=tooltip}t.over=function(feature,context,e){if(!feature)return;context.style.cursor="pointer";if(isPopup(_currentTooltip))return;else{_currentTooltip=getTooltip(feature,context);moveTooltip(e);if(context.addEventListener)context.addEventListener("mousemove",moveTooltip)}};t.out=function(context){context.style.cursor="default";if(isPopup(_currentTooltip))return;
else if(_currentTooltip){hideTooltip(_currentTooltip);if(context.removeEventListener)context.removeEventListener("mousemove",moveTooltip);_currentTooltip=undefined}};return t};var wax=wax||{};
wax.request={cache:{},locks:{},promises:{},get:function(url,callback){if(this.cache[url])return callback(this.cache[url][0],this.cache[url][1]);else{this.promises[url]=this.promises[url]||[];this.promises[url].push(callback);if(this.locks[url])return;var that=this;this.locks[url]=true;reqwest({url:url+(~url.indexOf("?")?"&":"?")+"callback=grid",type:"jsonp",jsonpCallback:"callback",success:function(data){that.locks[url]=false;that.cache[url]=[null,data];for(var i=0;i<that.promises[url].length;i++)that.promises[url][i](that.cache[url][0],
that.cache[url][1])},error:function(err){that.locks[url]=false;that.cache[url]=[err,null];for(var i=0;i<that.promises[url].length;i++)that.promises[url][i](that.cache[url][0],that.cache[url][1])}})}}};
wax.template=function(x){var template={};function urlX(url){if(/^(https?:\/\/|data:image)/.test(url))return url}function idX(id){return id}template.format=function(options,data){var clone={};for(var key in data)clone[key]=data[key];if(options.format)clone["__"+options.format+"__"]=true;return html_sanitize(Mustache.to_html(x,clone),urlX,idX)};return template};if(!wax)var wax={};
wax.tilejson=function(url,callback){reqwest({url:url+(~url.indexOf("?")?"&":"?")+"callback=grid",type:"jsonp",jsonpCallback:"callback",success:callback,error:callback})};var wax=wax||{};wax.tooltip={};wax.tooltip=function(options){this._currentTooltip=undefined;options=options||{};if(options.animationOut)this.animationOut=options.animationOut;if(options.animationIn)this.animationIn=options.animationIn};wax.tooltip.prototype.isPopup=function(el){return el&&el.className.indexOf("wax-popup")!==-1};
wax.tooltip.prototype.getTooltip=function(feature,context){var tooltip=document.createElement("div");tooltip.className="wax-tooltip wax-tooltip-0";tooltip.innerHTML=feature;context.appendChild(tooltip);return tooltip};
wax.tooltip.prototype.hideTooltip=function(el){if(!el)return;var event,remove=function(){if(this.parentNode)this.parentNode.removeChild(this)};if(el.style["-webkit-transition"]!==undefined&&this.animationOut)event="webkitTransitionEnd";else if(el.style.MozTransition!==undefined&&this.animationOut)event="transitionend";if(event){el.addEventListener(event,remove,false);el.addEventListener("transitionend",remove,false);el.className+=" "+this.animationOut}else if(el.parentNode)el.parentNode.removeChild(el)};
wax.tooltip.prototype.click=function(feature,context){if(this._currentTooltip){this.hideTooltip(this._currentTooltip);this._currentTooltip=undefined}var tooltip=this.getTooltip(feature,context);tooltip.className+=" wax-popup";tooltip.innerHTML=feature;var close=document.createElement("a");close.href="#close";close.className="close";close.innerHTML="Close";tooltip.appendChild(close);var closeClick=wax.util.bind(function(ev){this.hideTooltip(tooltip);this._currentTooltip=undefined;ev.returnValue=false;
if(ev.stopPropagation)ev.stopPropagation();if(ev.preventDefault)ev.preventDefault();return false},this);if(close.addEventListener)close.addEventListener("click",closeClick,false);else if(close.attachEvent)close.attachEvent("onclick",closeClick);this._currentTooltip=tooltip};wax.tooltip.prototype.over=function(feature,context){if(!feature)return;context.style.cursor="pointer";if(this.isPopup(this._currentTooltip))return;else this._currentTooltip=this.getTooltip(feature,context)};
wax.tooltip.prototype.out=function(context){context.style.cursor="default";if(this.isPopup(this._currentTooltip))return;else if(this._currentTooltip){this.hideTooltip(this._currentTooltip);this._currentTooltip=undefined}};var wax=wax||{};wax.util=wax.util||{};
wax.util={offset:function(el){var width=el.offsetWidth||parseInt(el.style.width,10),height=el.offsetHeight||parseInt(el.style.height,10),doc_body=document.body,top=0,left=0;var calculateOffset=function(el){if(el===doc_body||el===document.documentElement)return;top+=el.offsetTop;left+=el.offsetLeft;var style=el.style.transform||el.style.WebkitTransform||el.style.OTransform||el.style.MozTransform||el.style.msTransform;if(style)if(match=style.match(/translate\((.+)px, (.+)px\)/)){top+=parseInt(match[2],
10);left+=parseInt(match[1],10)}else if(match=style.match(/translate3d\((.+)px, (.+)px, (.+)px\)/)){top+=parseInt(match[2],10);left+=parseInt(match[1],10)}else if(match=style.match(/matrix3d\(([\-\d,\s]+)\)/)){var pts=match[1].split(",");top+=parseInt(pts[13],10);left+=parseInt(pts[12],10)}else if(match=style.match(/matrix\(.+, .+, .+, .+, (.+), (.+)\)/)){top+=parseInt(match[2],10);left+=parseInt(match[1],10)}};calculateOffset(el);try{while(el=el.offsetParent)calculateOffset(el)}catch(e){}top+=doc_body.offsetTop;
left+=doc_body.offsetLeft;top+=doc_body.parentNode.offsetTop;left+=doc_body.parentNode.offsetLeft;var htmlComputed=document.defaultView?window.getComputedStyle(doc_body.parentNode,null):doc_body.parentNode.currentStyle;if(doc_body.parentNode.offsetTop!==parseInt(htmlComputed.marginTop,10)&&!isNaN(parseInt(htmlComputed.marginTop,10))){top+=parseInt(htmlComputed.marginTop,10);left+=parseInt(htmlComputed.marginLeft,10)}return{top:top,left:left,height:height,width:width}},"$":function(x){return typeof x===
"string"?document.getElementById(x):x},bind:function(func,obj){var args=Array.prototype.slice.call(arguments,2);return function(){return func.apply(obj,args.concat(Array.prototype.slice.call(arguments)))}},isString:function(obj){return!!(obj===""||obj&&obj.charCodeAt&&obj.substr)},indexOf:function(array,item){var nativeIndexOf=Array.prototype.indexOf;if(array===null)return-1;var i,l;if(nativeIndexOf&&array.indexOf===nativeIndexOf)return array.indexOf(item);for(i=0,l=array.length;i<l;i++)if(array[i]===
item)return i;return-1},isArray:Array.isArray||function(obj){return Object.prototype.toString.call(obj)==="[object Array]"},keys:Object.keys||function(obj){var ho=Object.prototype.hasOwnProperty;if(obj!==Object(obj))throw new TypeError("Invalid object");var keys=[];for(var key in obj)if(ho.call(obj,key))keys[keys.length]=key;return keys},eventoffset:function(e){var posx=0;var posy=0;if(!e)var e=window.event;if(e.pageX||e.pageY)return{x:e.pageX,y:e.pageY};else if(e.clientX||e.clientY){var doc=document.documentElement,
body=document.body;var htmlComputed=document.body.parentNode.currentStyle;var topMargin=parseInt(htmlComputed.marginTop,10)||0;var leftMargin=parseInt(htmlComputed.marginLeft,10)||0;return{x:e.clientX+(doc&&doc.scrollLeft||body&&body.scrollLeft||0)-(doc&&doc.clientLeft||body&&body.clientLeft||0)+leftMargin,y:e.clientY+(doc&&doc.scrollTop||body&&body.scrollTop||0)-(doc&&doc.clientTop||body&&body.clientTop||0)+topMargin}}else if(e.touches&&e.touches.length===1)return{x:e.touches[0].pageX,y:e.touches[0].pageY}},
limit:function(func,wait,debounce){var timeout;return function(){var context=this,args=arguments;var throttler=function(){timeout=null;func.apply(context,args)};if(debounce)clearTimeout(timeout);if(debounce||!timeout)timeout=setTimeout(throttler,wait)}},throttle:function(func,wait){return this.limit(func,wait,false)},parseUri:function(str){var o={strictMode:false,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],
q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},m=o.parser[o.strictMode?"strict":"loose"].exec(str),uri={},i=14;while(i--)uri[o.key[i]]=m[i]||
"";uri[o.q.name]={};uri[o.key[12]].replace(o.q.parser,function($0,$1,$2){if($1)uri[o.q.name][$1]=$2});return uri},addUrlData:function(url,data){url+=this.parseUri(url).query?"&":"?";return url+=data}};wax=wax||{};wax.g=wax.g||{};
wax.g.attribution=function(map,tilejson){tilejson=tilejson||{};var a,attribution={};attribution.element=function(){return a.element()};attribution.appendTo=function(elem){wax.util.$(elem).appendChild(a.element());return this};attribution.init=function(){a=wax.attribution();a.set(tilejson.attribution);a.element().className="wax-attribution wax-g";return this};return attribution.init()};wax=wax||{};wax.g=wax.g||{};
wax.g.bwdetect=function(map,options){options=options||{};var lowpng=options.png||".png128",lowjpg=options.jpg||".jpg70";if(!map.mapTypes["mb-low"]){var mb=map.mapTypes.mb;var tilejson={tiles:[],scheme:mb.options.scheme,blankImage:mb.options.blankImage,minzoom:mb.minZoom,maxzoom:mb.maxZoom,name:mb.name,description:mb.description};for(var i=0;i<mb.options.tiles.length;i++)tilejson.tiles.push(mb.options.tiles[i].replace(".png",lowpng).replace(".jpg",lowjpg));m.mapTypes.set("mb-low",new wax.g.connector(tilejson))}return wax.bwdetect(options,
function(bw){map.setMapTypeId(bw?"mb":"mb-low")})};wax=wax||{};wax.g=wax.g||{};
wax.g.hash=function(map){return wax.hash({getCenterZoom:function(){var center=map.getCenter(),zoom=map.getZoom(),precision=Math.max(0,Math.ceil(Math.log(zoom)/Math.LN2));return[zoom.toFixed(2),center.lat().toFixed(precision),center.lng().toFixed(precision)].join("/")},setCenterZoom:function setCenterZoom(args){map.setCenter(new google.maps.LatLng(args[1],args[2]));map.setZoom(args[0])},bindChange:function(fn){google.maps.event.addListener(map,"idle",fn)},unbindChange:function(fn){google.maps.event.removeListener(map,
"idle",fn)}})};wax=wax||{};wax.g=wax.g||{};
wax.g.interaction=function(map,tilejson,options){tilejson=tilejson||{};options=options||{};var interaction={waxGM:new wax.GridManager(tilejson),callbacks:options.callbacks||new wax.tooltip,clickAction:options.clickAction||"full",eventHandlers:{},add:function(){this.eventHandlers.tileloaded=google.maps.event.addListener(map,"tileloaded",wax.util.bind(this.clearTileGrid,this));this.eventHandlers.idle=google.maps.event.addListener(map,"idle",wax.util.bind(this.clearTileGrid,this));this.eventHandlers.mousemove=
google.maps.event.addListener(map,"mousemove",this.onMove());this.eventHandlers.click=google.maps.event.addListener(map,"click",this.click());return this},remove:function(){google.maps.event.removeListener(this.eventHandlers.tileloaded);google.maps.event.removeListener(this.eventHandlers.idle);google.maps.event.removeListener(this.eventHandlers.mousemove);google.maps.event.removeListener(this.eventHandlers.click);return this},getTileGrid:function(){if(!this._getTileGrid){this._getTileGrid=[];var zoom=
map.getZoom();var mapOffset=wax.util.offset(map.getDiv());var get=wax.util.bind(function(mapType){if(!mapType.interactive)return;for(var key in mapType.cache){if(key.split("/")[0]!=zoom)continue;var tileOffset=wax.util.offset(mapType.cache[key]);this._getTileGrid.push([tileOffset.top-mapOffset.top,tileOffset.left-mapOffset.left,mapType.cache[key]])}},this);for(var i in map.mapTypes)get(map.mapTypes[i]);map.overlayMapTypes.forEach(get)}return this._getTileGrid},clearTileGrid:function(map,e){this._getTileGrid=
null},getTile:function(evt){var tile;var grid=this.getTileGrid();for(var i=0;i<grid.length;i++)if(grid[i][0]<evt.pixel.y&&grid[i][0]+256>evt.pixel.y&&grid[i][1]<evt.pixel.x&&grid[i][1]+256>evt.pixel.x){tile=grid[i][2];break}return tile||false},onMove:function(evt){if(!this._onMove)this._onMove=wax.util.bind(function(evt){var tile=this.getTile(evt);if(tile)this.waxGM.getGrid(tile.src,wax.util.bind(function(err,g){if(err||!g)return;var feature=g.tileFeature(evt.pixel.x+wax.util.offset(map.getDiv()).left,
evt.pixel.y+wax.util.offset(map.getDiv()).top,tile,{format:"teaser"});if(feature&&this.feature!==feature){this.feature=feature;this.callbacks.out(map.getDiv());this.callbacks.over(feature,map.getDiv(),0,evt)}else if(!feature){this.feature=null;this.callbacks.out(map.getDiv())}},this))},this);return this._onMove},click:function(evt){if(!this._onClick)this._onClick=wax.util.bind(function(evt){if(window.event&&window.event.cancelBubble)return false;var tile=this.getTile(evt);if(tile)this.waxGM.getGrid(tile.src,
wax.util.bind(function(err,g){if(err||!g)return;var feature=g.tileFeature(evt.pixel.x+wax.util.offset(map.getDiv()).left,evt.pixel.y+wax.util.offset(map.getDiv()).top,tile,{format:this.clickAction});if(feature){if(!window.event){window.event={};setTimeout(function(){window.event=null},150)}window.event.cancelBubble=true;switch(this.clickAction){case "full":this.callbacks.click(feature,map.getDiv(),0,evt);break;case "location":window.location=feature;break}}},this))},this);return this._onClick}};return interaction.add(map)};
wax=wax||{};wax.g=wax.g||{};wax.g.legend=function(map,tilejson){tilejson=tilejson||{};var l,legend={};legend.add=function(){l=wax.legend().content(tilejson.legend||"");return this};legend.element=function(){return l.element()};legend.appendTo=function(elem){wax.util.$(elem).appendChild(l.element());return this};return legend.add()};var wax=wax||{};wax.g=wax.g||{};
wax.g.connector=function(options){options=options||{};this.options={tiles:options.tiles,scheme:options.scheme||"xyz",blankImage:options.blankImage};this.minZoom=options.minzoom||0;this.maxZoom=options.maxzoom||22;this.name=options.name||"";this.description=options.description||"";this.interactive=true;this.tileSize=new google.maps.Size(256,256);this.cache={}};
wax.g.connector.prototype.getTile=function(coord,zoom,ownerDocument){var key=zoom+"/"+coord.x+"/"+coord.y;if(!this.cache[key]){var img=this.cache[key]=new Image(256,256);this.cache[key].src=this.getTileUrl(coord,zoom);this.cache[key].setAttribute("gTileKey",key);this.cache[key].onerror=function(){img.style.display="none"}}return this.cache[key]};wax.g.connector.prototype.releaseTile=function(tile){var key=tile.getAttribute("gTileKey");this.cache[key]&&delete this.cache[key];tile.parentNode&&tile.parentNode.removeChild(tile)};
wax.g.connector.prototype.getTileUrl=function(coord,z){var mod=Math.pow(2,z),y=this.options.scheme==="tms"?mod-1-coord.y:coord.y,x=coord.x%mod;x=x<0?coord.x%mod+mod:x;if(y<0)return this.options.blankImage;return this.options.tiles[parseInt(x+y,10)%this.options.tiles.length].replace("{z}",z).replace("{x}",x).replace("{y}",y)};
